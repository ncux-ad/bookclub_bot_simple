"""
@file: keyboards/inline.py
@description: Inline ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Ğ±Ğ¾Ñ‚Ğ°
@dependencies: aiogram.types
@created: 2025-01-03
"""

from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from typing import Dict, List, Any


def create_books_keyboard(books: Dict[str, Any]) -> InlineKeyboardMarkup:
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ ĞºĞ½Ğ¸Ğ³
    
    Args:
        books (Dict[str, Any]): Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ½Ğ¸Ğ³
        
    Returns:
        InlineKeyboardMarkup: Inline ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ ĞºĞ½Ğ¸Ğ³
    """
    keyboard = []
    
    for book_title in books.keys():
        keyboard.append([
            InlineKeyboardButton(
                text=book_title, 
                callback_data=f"book:{book_title}"
            )
        ])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_book_keyboard(book_title: str, formats: List[str]) -> InlineKeyboardMarkup:
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° ĞºĞ½Ğ¸Ğ³Ğ¸
    
    Args:
        book_title (str): ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ¸
        formats (List[str]): Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ²
        
    Returns:
        InlineKeyboardMarkup: Inline ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ²
    """
    keyboard = []
    
    for fmt in formats:
        keyboard.append([
            InlineKeyboardButton(
                text=fmt, 
                callback_data=f"download:{book_title}:{fmt.lower()}"
            )
        ])
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°
    keyboard.append([
        InlineKeyboardButton(text="Â« ĞĞ°Ğ·Ğ°Ğ´", callback_data="back_to_books")
    ])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_back_keyboard() -> InlineKeyboardMarkup:
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°"""
    keyboard = [
        [InlineKeyboardButton(text="Â« ĞĞ°Ğ·Ğ°Ğ´", callback_data="back_to_books")]
    ]
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_admin_keyboard() -> InlineKeyboardMarkup:
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°
    
    Returns:
        InlineKeyboardMarkup: Inline ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°:
            - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
            - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
            - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸
            - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸
    """
    keyboard = [
        [InlineKeyboardButton(text="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°", callback_data="admin_stats")],
        [InlineKeyboardButton(text="ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸", callback_data="admin_users")],
        [InlineKeyboardButton(text="ğŸ“š Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸", callback_data="admin_books")],
        [InlineKeyboardButton(text="ğŸ“… Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸", callback_data="admin_events")]
    ]
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard) 


def create_book_confirmation_keyboard() -> InlineKeyboardMarkup:
    """
    ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ½Ğ¸Ğ³Ğ¸
    """
    keyboard = [
        [
            InlineKeyboardButton(text="ğŸ“š Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", callback_data="edit_title"),
            InlineKeyboardButton(text="âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°", callback_data="edit_author")
        ],
        [
            InlineKeyboardButton(text="ğŸ“ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", callback_data="edit_description")
        ],
        [
            InlineKeyboardButton(text="ğŸ”— Ğ¯Ğ½Ğ´ĞµĞºÑ.ĞšĞ½Ğ¸Ğ³Ğ¸", callback_data="add_yandex"),
            InlineKeyboardButton(text="ğŸ”— Ğ›Ğ¸Ñ‚Ğ ĞµÑ", callback_data="add_litres")
        ],
        [
            InlineKeyboardButton(text="ğŸ§ ĞÑƒĞ´Ğ¸Ğ¾ĞºĞ½Ğ¸Ğ³Ğ°", callback_data="add_audio")
        ],
        [
            InlineKeyboardButton(text="âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¸Ğ³Ñƒ", callback_data="confirm_add")
        ]
    ]
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_skip_keyboard() -> InlineKeyboardMarkup:
    """
    ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ "ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
    """
    keyboard = [
        [
            InlineKeyboardButton(text="â­ï¸ ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ", callback_data="skip")
        ]
    ]
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_book_selection_keyboard(books: list, event_id: str = None) -> InlineKeyboardMarkup:
    """
    ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ĞºĞ½Ğ¸Ğ³Ğ¸
    
    Args:
        books: Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ½Ğ¸Ğ³
        event_id: ID ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (ĞµÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ)
    """
    keyboard = []
    
    for book in books[:10]:  # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ 10 ĞºĞ½Ğ¸Ğ³Ğ°Ğ¼Ğ¸
        book_id = book.get('id', '')
        title = book.get('title', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ')
        author = book.get('author', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ñ€')
        
        # Ğ¡Ğ¾ĞºÑ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
        button_text = f"{title[:20]}{'...' if len(title) > 20 else ''} - {author[:15]}{'...' if len(author) > 15 else ''}"
        
        if event_id:
            callback_data = f"select_book_{book_id}_for_event_{event_id}"
        else:
            callback_data = f"select_book_{book_id}"
        
        keyboard.append([InlineKeyboardButton(text=button_text, callback_data=callback_data)])
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ½Ğ¸Ğ³Ñƒ"
    if event_id:
        keyboard.append([InlineKeyboardButton(text="ğŸ“š Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ½Ğ¸Ğ³Ñƒ", callback_data=f"add_new_book_for_event_{event_id}")])
    else:
        keyboard.append([InlineKeyboardButton(text="ğŸ“š Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ½Ğ¸Ğ³Ñƒ", callback_data="add_new_book")])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def create_book_management_keyboard(book_id: str) -> InlineKeyboardMarkup:
    """
    ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ½Ğ¸Ğ³Ğ¾Ğ¹
    """
    keyboard = [
        [
            InlineKeyboardButton(text="ğŸ“ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", callback_data=f"edit_book_{book_id}"),
            InlineKeyboardButton(text="ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ", callback_data=f"delete_book_{book_id}")
        ],
        [
            InlineKeyboardButton(text="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°", callback_data=f"book_stats_{book_id}"),
            InlineKeyboardButton(text="ğŸ”— Ğ¡ÑÑ‹Ğ»ĞºĞ¸", callback_data=f"book_links_{book_id}")
        ],
        [
            InlineKeyboardButton(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="back_to_books")
        ]
    ]
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard) 